<!-- Customers Page - VEGA CRM Theme -->
<style>
    .vega-page { min-height: calc(100vh - 60px); background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 24px; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
    
    /* Header Section */
    .vega-page-header { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 20px; padding: 32px; margin-bottom: 24px; color: white; box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3); }
    .vega-page-header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
    .vega-page-title-section { display: flex; align-items: center; gap: 16px; }
    .vega-page-icon { width: 56px; height: 56px; background: rgba(255,255,255,0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; }
    .vega-page-title { font-size: 1.8rem; font-weight: 800; margin: 0; }
    .vega-page-subtitle { font-size: 0.95rem; opacity: 0.9; margin-top: 4px; }
    
    /* Action Buttons */
    .vega-page-actions { display: flex; gap: 12px; flex-wrap: wrap; }
    .vega-action-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
    .vega-action-btn-primary { background: white; color: #6366f1; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .vega-action-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
    .vega-action-btn-secondary { background: rgba(255,255,255,0.2); color: white; backdrop-filter: blur(10px); }
    .vega-action-btn-secondary:hover { background: rgba(255,255,255,0.3); }
    
    /* Stats Cards */
    .vega-stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .vega-stat-card { background: white; border-radius: 16px; padding: 20px 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 16px; transition: all 0.3s; }
    .vega-stat-card:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
    .vega-stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
    .vega-stat-icon.blue { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
    .vega-stat-icon.green { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); }
    .vega-stat-icon.yellow { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
    .vega-stat-icon.purple { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); }
    .vega-stat-value { font-size: 1.6rem; font-weight: 800; color: #1e293b; line-height: 1; }
    .vega-stat-label { font-size: 0.85rem; color: #64748b; margin-top: 4px; }
    
    /* Filter Section */
    .vega-filters-card { background: white; border-radius: 16px; padding: 20px 24px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    .vega-filters-row { display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
    .vega-search-box { flex: 1; min-width: 250px; position: relative; }
    .vega-search-box input { width: 100%; padding: 14px 20px 14px 48px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 0.95rem; transition: all 0.3s; background: #f8fafc; }
    .vega-search-box input:focus { outline: none; border-color: #6366f1; background: white; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
    .vega-search-box svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; }
    .vega-filter-select { padding: 14px 20px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 0.95rem; background: #f8fafc; min-width: 160px; cursor: pointer; transition: all 0.3s; }
    .vega-filter-select:focus { outline: none; border-color: #6366f1; background: white; }
    .vega-filter-btn { padding: 14px 20px; border: 2px solid #e5e7eb; border-radius: 12px; background: white; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: 500; color: #64748b; transition: all 0.3s; }
    .vega-filter-btn:hover { border-color: #6366f1; color: #6366f1; }
    .vega-filter-btn.active { background: #6366f1; color: white; border-color: #6366f1; }
    
    /* Table Card */
    .vega-table-card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); overflow: hidden; }
    .vega-table-header { padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
    .vega-table-title { font-size: 1.1rem; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 10px; }
    .vega-table-count { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
    .vega-table-actions { display: flex; gap: 8px; }
    .vega-table-action-btn { padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-size: 0.85rem; color: #64748b; transition: all 0.2s; }
    .vega-table-action-btn:hover { border-color: #6366f1; color: #6366f1; }
    
    /* View Toggle */
    .vega-view-toggle { display: flex; background: #f1f5f9; border-radius: 10px; padding: 4px; }
    .vega-view-btn { padding: 8px 16px; border: none; background: transparent; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; color: #64748b; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
    .vega-view-btn.active { background: white; color: #6366f1; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    
    @media (max-width: 768px) {
        .vega-page-header-content { flex-direction: column; align-items: flex-start; }
        .vega-stats-row { grid-template-columns: repeat(2, 1fr); }
        .vega-filters-row { flex-direction: column; }
        .vega-search-box { min-width: 100%; }
    }
</style>

<section id="customers" class="section vega-page">
    <!-- Page Header -->
    <div class="vega-page-header">
        <div class="vega-page-header-content">
            <div class="vega-page-title-section">
                <div class="vega-page-icon">üè¢</div>
                <div>
                    <h1 class="vega-page-title">Account Management</h1>
                    <p class="vega-page-subtitle">Manage your customers and business accounts</p>
                </div>
            </div>
            <div class="vega-page-actions">
                <button class="vega-action-btn vega-action-btn-primary" onclick="loadPage('add-customer')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Account
                </button>
                <button class="vega-action-btn vega-action-btn-secondary" onclick="loadPage('accountreport')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    Reports
                </button>
                <button class="vega-action-btn vega-action-btn-secondary" onclick="showAccountImportModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Import
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="vega-stats-row">
        <div class="vega-stat-card">
            <div class="vega-stat-icon blue">üìä</div>
            <div>
                <div class="vega-stat-value" id="statTotalAccounts">0</div>
                <div class="vega-stat-label">Total Accounts</div>
            </div>
        </div>
        <div class="vega-stat-card">
            <div class="vega-stat-icon green">‚úÖ</div>
            <div>
                <div class="vega-stat-value" id="statActiveAccounts">0</div>
                <div class="vega-stat-label">Active</div>
            </div>
        </div>
        <div class="vega-stat-card">
            <div class="vega-stat-icon yellow">‚è≥</div>
            <div>
                <div class="vega-stat-value" id="statProspectAccounts">0</div>
                <div class="vega-stat-label">Prospects</div>
            </div>
        </div>
        <div class="vega-stat-card">
            <div class="vega-stat-icon purple">üí∞</div>
            <div>
                <div class="vega-stat-value" id="statTotalValue">‚Çπ0</div>
                <div class="vega-stat-label">Total Value</div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="vega-filters-card">
        <div class="vega-filters-row">
            <div class="vega-search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="customerSearch" placeholder="Search accounts by name, email, phone..." onkeyup="loadCustomers()">
            </div>
            <select id="customerStatusFilter" class="vega-filter-select" onchange="loadCustomers()">
                <option value="">All Status</option>
                <option value="active">‚úÖ Active</option>
                <option value="inactive">‚è∏Ô∏è Inactive</option>
                <option value="prospect">‚è≥ Prospect</option>
                <option value="lost">‚ùå Lost</option>
            </select>
            <select id="customerTypeFilter" class="vega-filter-select" onchange="loadCustomers()">
                <option value="">All Types</option>
                <option value="business">üè¢ Business</option>
                <option value="individual">üë§ Individual</option>
            </select>
            <div class="vega-view-toggle">
                <button class="vega-view-btn active" onclick="switchAccountView('table')" id="tableViewBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                    Table
                </button>
                <button class="vega-view-btn" onclick="switchAccountView('cards')" id="cardsViewBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                    </svg>
                    Cards
                </button>
            </div>
        </div>
    </div>

    <!-- Table Card -->
    <div class="vega-table-card" id="tableViewContainer">
        <div class="vega-table-header">
            <div class="vega-table-title">
                <span>üìã Accounts List</span>
                <span class="vega-table-count" id="accountsCount">0</span>
            </div>
            <div class="vega-table-actions">
                <button class="vega-table-action-btn" onclick="exportAccounts('csv')">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export
                </button>
                <button class="vega-table-action-btn" onclick="loadCustomers()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>
        <div id="customersTable" class="table-container-advanced"></div>
    </div>
    
    <!-- Cards View Container -->
    <div id="cardsViewContainer" style="display:none;">
        <div class="vega-table-header" style="background:white; border-radius:16px 16px 0 0; padding:20px 24px; border-bottom:1px solid #e5e7eb;">
            <div class="vega-table-title">
                <span>üìã Accounts</span>
                <span class="vega-table-count" id="accountsCountCards">0</span>
            </div>
            <div class="vega-table-actions">
                <button class="vega-table-action-btn" onclick="loadCustomers()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>
        <div id="accountCardsGrid" class="account-cards-grid"></div>
    </div>
</section>

<style>
/* Account Cards Grid */
.account-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
    padding: 20px;
    background: white;
    border-radius: 0 0 16px 16px;
}

.account-card {
    background: white;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    padding: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.account-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(99, 102, 241, 0.15);
    border-color: #6366f1;
}

.account-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
}

.account-card-header {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    margin-bottom: 16px;
}

.account-avatar {
    width: 52px;
    height: 52px;
    border-radius: 12px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.3rem;
    font-weight: 700;
    flex-shrink: 0;
}

.account-card-info {
    flex: 1;
    min-width: 0;
}

.account-card-name {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.account-card-company {
    font-size: 0.85rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 6px;
}

.account-card-badges {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.account-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.account-badge.status-active { background: #dcfce7; color: #166534; }
.account-badge.status-inactive { background: #f1f5f9; color: #475569; }
.account-badge.status-prospect { background: #fef3c7; color: #92400e; }
.account-badge.status-lost { background: #fee2e2; color: #991b1b; }
.account-badge.type-business { background: #dbeafe; color: #1e40af; }
.account-badge.type-individual { background: #ede9fe; color: #5b21b6; }

.account-card-details {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 16px;
}

.account-detail-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9rem;
    color: #475569;
}

.account-detail-row svg {
    width: 16px;
    height: 16px;
    color: #94a3b8;
    flex-shrink: 0;
}

.account-detail-row span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.account-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 16px;
    border-top: 1px solid #f1f5f9;
}

.account-health {
    display: flex;
    align-items: center;
    gap: 8px;
}

.health-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.health-dot.green { background: #10b981; }
.health-dot.yellow { background: #f59e0b; }
.health-dot.red { background: #ef4444; }

.account-card-actions {
    display: flex;
    gap: 8px;
}

.account-card-actions button {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
    background: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.account-card-actions button:hover {
    background: #6366f1;
    border-color: #6366f1;
    color: white;
}

.account-card-actions button svg {
    width: 16px;
    height: 16px;
}

@media (max-width: 768px) {
    .account-cards-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<!-- Form Modal for Edit Customer -->
<div id="formModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:99999; align-items:center; justify-content:center;">
    <div id="formContent" class="modal-content" style="background:white; border-radius:16px; max-width:750px; width:90%; max-height:90vh; overflow-y:auto; padding:32px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);"></div>
</div>

<style>
/* Form Modal Styles for Accounts */
#formModal .form-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #e2e8f0;
}
#formModal .form-modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
}
#formModal .btn-close-modal {
    background: #f1f5f9;
    border: none;
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    transition: all 0.2s;
}
#formModal .btn-close-modal:hover {
    background: #e2e8f0;
}
#formModal .form-section-advanced {
    margin-bottom: 24px;
}
#formModal .form-section-title {
    font-size: 1rem;
    font-weight: 600;
    color: #475569;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid #f1f5f9;
}
#formModal .form-group-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}
@media (max-width: 600px) {
    #formModal .form-group-grid {
        grid-template-columns: 1fr;
    }
}
#formModal .form-group-advanced {
    display: flex;
    flex-direction: column;
}
#formModal .form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #475569;
    margin-bottom: 6px;
}
#formModal .form-label .required {
    color: #ef4444;
}
#formModal .form-input-advanced,
#formModal .form-select-advanced,
#formModal .form-textarea-advanced {
    padding: 10px 14px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 0.95rem;
    transition: all 0.2s;
    background: #f8fafc;
}
#formModal .form-input-advanced:focus,
#formModal .form-select-advanced:focus,
#formModal .form-textarea-advanced:focus {
    outline: none;
    border-color: #6366f1;
    background: white;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}
#formModal .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}
#formModal .btn-secondary {
    padding: 12px 24px;
    background: #e2e8f0;
    color: #475569;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}
#formModal .btn-secondary:hover {
    background: #cbd5e1;
}
#formModal .btn-primary {
    padding: 12px 24px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
}
#formModal .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
}
</style>

<script>
// Update stats when customers load
window.updateAccountStats = function(customers) {
    if (!customers) return;
    const total = customers.length;
    const active = customers.filter(c => c.status === 'active').length;
    const prospect = customers.filter(c => c.status === 'prospect').length;
    
    document.getElementById('statTotalAccounts').textContent = total;
    document.getElementById('statActiveAccounts').textContent = active;
    document.getElementById('statProspectAccounts').textContent = prospect;
    document.getElementById('accountsCount').textContent = total;
};

window.switchAccountView = function(view) {
    document.getElementById('tableViewBtn').classList.toggle('active', view === 'table');
    document.getElementById('cardsViewBtn').classList.toggle('active', view === 'cards');
    
    const tableContainer = document.getElementById('tableViewContainer');
    const cardsContainer = document.getElementById('cardsViewContainer');
    
    if (view === 'table') {
        tableContainer.style.display = 'block';
        cardsContainer.style.display = 'none';
    } else {
        tableContainer.style.display = 'none';
        cardsContainer.style.display = 'block';
        renderAccountCards();
    }
};

window.renderAccountCards = function() {
    const grid = document.getElementById('accountCardsGrid');
    if (!grid) return;
    
    // Get customers data from global variable
    const customers = window.customersData || [];
    
    if (customers.length === 0) {
        grid.innerHTML = '<div style="text-align:center; padding:40px; color:#64748b;">No accounts found. Please refresh the page.</div>';
        return;
    }
    
    document.getElementById('accountsCountCards').textContent = customers.length;
    
    grid.innerHTML = customers.map(customer => {
        const initials = (customer.name || 'NA').split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        const status = customer.status || 'active';
        const type = customer.customer_type || 'business';
        const health = customer.health_score || 'green';
        
        return `
            <div class="account-card">
                <div class="account-card-header">
                    <div class="account-avatar">${initials}</div>
                    <div class="account-card-info">
                        <div class="account-card-name">${escapeHtml(customer.name || '-')}</div>
                        <div class="account-card-company">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M3 21h18M3 7v14M21 7v14M6 11h.01M6 15h.01M6 19h.01M10 11h.01M10 15h.01M10 19h.01M14 11h.01M14 15h.01M14 19h.01M18 11h.01M18 15h.01M18 19h.01M6 7V3h12v4"></path>
                            </svg>
                            ${escapeHtml(customer.company_name || customer.industry || '-')}
                        </div>
                    </div>
                </div>
                
                <div class="account-card-badges">
                    <span class="account-badge status-${status}">${status}</span>
                    <span class="account-badge type-${type}">${type}</span>
                </div>
                
                <div class="account-card-details">
                    ${customer.email ? `
                    <div class="account-detail-row">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        <span>${escapeHtml(customer.email)}</span>
                    </div>` : ''}
                    ${customer.phone ? `
                    <div class="account-detail-row">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <span>${escapeHtml(customer.phone)}</span>
                    </div>` : ''}
                    ${customer.city ? `
                    <div class="account-detail-row">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <span>${escapeHtml(customer.city)}${customer.state ? ', ' + escapeHtml(customer.state) : ''}</span>
                    </div>` : ''}
                </div>
                
                <div class="account-card-footer">
                    <div class="account-health">
                        <span class="health-dot ${health}"></span>
                        <span style="font-size:0.85rem; color:#64748b;">Health: ${health}</span>
                    </div>
                    <div class="account-card-actions">
                        <button onclick="editCustomer(${customer.id})" title="Edit">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        <button onclick="deleteCustomer(${customer.id})" title="Delete">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
};

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

window.exportAccounts = function(format) {
    alert('Export feature coming soon!');
};
</script>

